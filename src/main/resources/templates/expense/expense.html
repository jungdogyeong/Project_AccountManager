<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>지출 분석</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-blue: #6a82fb;
            --primary-gradient: linear-gradient(135deg, #6a82fb, #4c64f6);
            --light-gray-bg: #f9f9f9;
            --item-bg: #ffffff;
            --border-color: #eef2f7;
            --text-color: #343a40;
            --text-secondary: #868e96;
        }
        body {
            margin: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--light-gray-bg);
        }

        .top-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 16px;
            background-color: var(--item-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 10;
        }
        .top-bar h1 {
            margin: 0; font-size: 18px; font-weight: 600;
        }

        .container {
            padding: 24px 16px;
        }

        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .month-nav button {
            background: none; border: none; font-size: 24px;
            color: var(--text-secondary); cursor: pointer;
        }
        .month-nav #currentMonth {
            font-family: 'Poppins', sans-serif;
            font-size: 20px; font-weight: 600;
        }

        .card {
            background: var(--item-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            border: 1px solid var(--border-color);
        }
        .card-title {
            font-size: 16px; font-weight: 700;
            margin: 0 0 20px 0;
        }

        /* ▼▼▼ 수정된 스타일: 주차별 지출 목록 ▼▼▼ */
        .week-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .week-item {
            display: flex;
            justify-content: space-between; /* 양쪽 끝으로 정렬 */
            align-items: center;
            font-size: 15px;
        }
        /* 점선(.line) 스타일 제거 */
        .week-item .week-label {
            color: var(--text-color);
            font-weight: 500;
        }
        .week-item .week-amount {
            color: var(--text-color);
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
        }
        /* ▲▲▲ 스타일 수정 완료 ▲▲▲ */

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 250px;
            margin: 0 auto;
        }
        #chartTotal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
        }
        #chartTotal .label {
            font-size: 14px; font-weight: 500;
            color: var(--text-secondary);
        }
        #chartTotal .total-amount {
            font-family: 'Poppins', sans-serif;
            font-size: 24px; font-weight: 700;
            color: var(--text-color);
        }

        .category-list {
            display: flex; flex-direction: column; gap: 16px;
        }
        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .category-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .category-info .legend-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
        }
        .category-info .icon {
            font-size: 20px;
            width: 40px; height: 40px;
            border-radius: 12px;
            background: #f1f3f5;
            display: flex; align-items: center; justify-content: center;
        }
        .category-info .name {
            font-size: 15px; font-weight: 500;
        }
        .category-amount .amount {
            font-size: 16px; font-weight: 600;
            font-family: 'Poppins', sans-serif;
        }
        .category-amount .percentage {
            font-size: 13px; color: var(--text-secondary);
            margin-left: 8px;
        }
    </style>
</head>
<body>
<div class="top-bar">
    <h1>지출 분석</h1>
</div>

<div class="container">
    <div class="month-nav">
        <button onclick="changeMonth(-1)">‹</button>
        <span id="currentMonth">9월</span>
        <button onclick="changeMonth(1)">›</button>
    </div>

    <div class="card">
        <div class="week-list" id="weekList">
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">카테고리별 지출</h2>
        <div class="chart-container">
            <canvas id="expenseChart"></canvas>
            <div id="chartTotal"></div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">상세 내역</h2>
        <div class="category-list" id="categoryList">
        </div>
    </div>
</div>

<script>
    // --- 샘플 데이터 ---
    const weeklyData = [
        { week: "9월 1주", amount: 50000 },
        { week: "9월 2주", amount: 70000 },
        { week: "9월 3주", amount: 40000 },
        { week: "9월 4주", amount: 65000 }
    ];

    const expenseData = {
        labels: ['식비', '교통비', '쇼핑', '문화생활', '기타'],
        values: [95000, 60000, 120000, 75000, 30000],
        colors: ['#845ef7', '#22b8cf', '#fcc419', '#40c057', '#adb5bd'],
        icons: { '식비': '🍚', '교통비': '🚌', '쇼핑': '🛍️', '문화생활': '🎬', '기타': '✨' }
    };

    // --- 월 변경 ---
    let currentMonth = 9;
    const monthEl = document.getElementById("currentMonth");
    function changeMonth(direction) {
        currentMonth += direction;
        if (currentMonth < 1) currentMonth = 12;
        if (currentMonth > 12) currentMonth = 1;
        monthEl.textContent = `${currentMonth}월`;
    }

    // --- 주차별 목록 생성 ---
    const weekListEl = document.getElementById('weekList');
    weeklyData.forEach(item => {
        const weekItem = document.createElement('div');
        weekItem.className = 'week-item';
        /* ▼▼▼ 수정된 SCRIPT: 점선(.line) 제거 ▼▼▼ */
        weekItem.innerHTML = `
            <span class="week-label">${item.week}</span>
            <span class="week-amount">${item.amount.toLocaleString()}원</span>
        `;
        /* ▲▲▲ SCRIPT 수정 완료 ▲▲▲ */
        weekListEl.appendChild(weekItem);
    });

    // --- 원형 그래프 생성 ---
    const ctx = document.getElementById('expenseChart').getContext('2d');
    const totalExpense = expenseData.values.reduce((a, b) => a + b, 0);

    const expenseChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: expenseData.labels,
            datasets: [{
                data: expenseData.values,
                backgroundColor: expenseData.colors,
                borderColor: '#fff',
                borderWidth: 4,
                hoverBorderWidth: 4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            cutout: '70%',
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            let value = context.raw;
                            let percentage = ((value / totalExpense) * 100).toFixed(1);
                            return `${label}: ${value.toLocaleString()}원 (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });

    const chartTotalEl = document.getElementById('chartTotal');
    chartTotalEl.innerHTML = `
        <div class="label">총 지출</div>
        <div class="total-amount">${totalExpense.toLocaleString()}원</div>
    `;

    // --- 카테고리 목록 생성 ---
    const categoryListEl = document.getElementById('categoryList');
    expenseData.labels.forEach((label, index) => {
        const value = expenseData.values[index];
        const percentage = ((value / totalExpense) * 100).toFixed(0);
        const color = expenseData.colors[index];

        const item = document.createElement('div');
        item.className = 'category-item';
        item.innerHTML = `
            <div class="category-info">
                <span class="legend-dot" style="background-color: ${color};"></span>
                <span class="icon">${expenseData.icons[label] || '❔'}</span>
                <span class="name">${label}</span>
            </div>
            <div class="category-amount">
                <span class="amount">${value.toLocaleString()}원</span>
                <span class="percentage">(${percentage}%)</span>
            </div>
        `;
        categoryListEl.appendChild(item);
    });
</script>
</body>
</html>